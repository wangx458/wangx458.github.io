<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Files — wangx458.github.io</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 900px; margin: 2.5rem auto; padding: 0 1rem; color:#111; line-height:1.6 }
    h1 { margin-bottom: 0.5rem }
    #note { color:#555; margin-bottom: 1rem; }
    ul { padding-left: 1.1rem }
    li { margin: 0.45rem 0 }
    a { color: #0366d6; text-decoration: none }
    a:hover { text-decoration: underline }
    .meta { color:#666; font-size:0.95rem; margin-top:1rem }
    .empty { color:#777; background:#f7f7f9; padding:1rem; border-radius:6px }
  </style>
</head>
<body>
  <header>
    <h1>Files</h1>
    <div id="note">下方列出仓库 <code>files/</code> 目录中的文件，点击即可在新标签页中打开对应文件。</div>
  </header>

  <main id="content">
    <p class="empty">正在加载文件列表…</p>
  </main>

  <footer class="meta">
    <p>若想显示其他目录，请把文件放到 <code>files/</code> 或联系我修改脚本。</p>
  </footer>

  <script>
    // 使用 GitHub 公共 API 获取仓库 files/ 目录内容并渲染为链接
    (async function() {
      const owner = 'wangx458';
      const repo = 'wangx458.github.io';
      const path = 'files';
      const api = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
      const container = document.getElementById('content');

      try {
        const resp = await fetch(api, { headers: { 'Accept': 'application/vnd.github.v3+json' } });
        if (!resp.ok) {
          container.innerHTML = `<p class="empty">无法读取文件列表（HTTP ${resp.status}）。请确认仓库为公开或稍后重试。</p>`;
          return;
        }
        const data = await resp.json();
        if (!Array.isArray(data) || data.length === 0) {
          container.innerHTML = '<p class="empty">目录为空。请把要发布的文件上传到 <code>files/</code> 目录。</p>';
          return;
        }
        // 构建文件列表
        const ul = document.createElement('ul');
        data.forEach(item => {
          // 仅列出文件（忽略子目录）；若需要包含目录，可扩展处理
          if (item.type === 'file') {
            const li = document.createElement('li');
            // raw.githubusercontent.com URL 可以直接访问原始文件
            // 构造 raw URL: https://raw.githubusercontent.com/{owner}/{repo}/main/{path}/{name}
            const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/main/${path}/${encodeURIComponent(item.name)}`;
            const a = document.createElement('a');
            a.href = rawUrl;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.textContent = item.name;
            li.appendChild(a);
            const sizeSpan = document.createElement('span');
            sizeSpan.style.color = '#666';
            sizeSpan.style.marginLeft = '0.6rem';
            sizeSpan.textContent = `(${Math.round(item.size/1024*10)/10} KB)`;
            li.appendChild(sizeSpan);
            ul.appendChild(li);
          }
        });
        container.innerHTML = '';
        container.appendChild(ul);
      } catch (err) {
        container.innerHTML = `<p class="empty">加载失败：${err.message}</p>`;
      }
    })();
  </script>
</body>
</html>
